<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LEOCHAT // PHANTOM PROTOCOL</title>
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="data:application/manifest+json,{'name':'LeoChat','short_name':'LeoChat','start_url':'.','display':'standalone','background_color':'#030308','theme_color':'#00f3ff'}">

    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    
    <style>
        :root { --neon: #00f3ff; --magenta: #ff00ff; --bg: #030308; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; user-select: none; }
        #canvas { position: fixed; top: 0; left: 0; z-index: 1; opacity: 0.25; }

        .app-container { position: relative; z-index: 10; display: flex; align-items: center; justify-content: center; height: 100vh; }
        .chat-card { width: 100%; max-width: 450px; height: 100%; max-height: 850px; background: rgba(10, 10, 25, 0.7); backdrop-filter: blur(30px); display: flex; flex-direction: column; overflow: hidden; position: relative; border: 1px solid rgba(255,255,255,0.1); }

        /* Header */
        .header { padding: 40px 20px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
        h1 { margin: 0; font-size: 1.4rem; letter-spacing: 5px; color: var(--neon); text-shadow: 0 0 15px var(--neon); }
        #my-id-display { font-size: 0.7rem; color: rgba(255,255,255,0.5); margin-top: 10px; cursor: pointer; transition: 0.3s; }
        #my-id-display:active { color: var(--neon); transform: scale(0.95); }

        /* Mensagens */
        .chat-body { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .msg { max-width: 75%; padding: 12px 18px; border-radius: 20px; font-size: 0.95rem; animation: slideUp 0.4s ease; position: relative; transition: 0.2s; }
        .sent { align-self: flex-end; background: linear-gradient(135deg, rgba(0,243,255,0.2), rgba(0,243,255,0.05)); border: 1px solid rgba(0,243,255,0.2); }
        .received { align-self: flex-start; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); }
        
        /* Sistema de Resposta */
        .reply-preview { font-size: 0.75rem; background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 10px; border-left: 2px solid var(--neon); margin-bottom: 5px; opacity: 0.7; }
        #reply-bar { display: none; padding: 10px 20px; background: rgba(0,243,255,0.1); border-top: 1px solid var(--neon); font-size: 0.8rem; justify-content: space-between; align-items: center; }

        /* Menu de Contexto (Rea√ß√µes/Responder) */
        .context-menu { position: fixed; display: none; background: rgba(20,20,30,0.95); backdrop-filter: blur(10px); border-radius: 20px; padding: 10px; z-index: 100; border: 1px solid var(--neon); box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .reactions { display: flex; gap: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; margin-bottom: 8px; }
        .reaction-btn { cursor: pointer; font-size: 1.2rem; transition: 0.2s; }
        .reaction-btn:hover { transform: scale(1.3); }
        .menu-opt { font-size: 0.9rem; padding: 5px; text-align: center; cursor: pointer; color: var(--neon); }

        /* Footer */
        .footer { padding: 20px; }
        .input-wrapper { background: rgba(255,255,255,0.07); border-radius: 25px; padding: 5px 15px; display: flex; align-items: center; gap: 12px; border: 1px solid rgba(255,255,255,0.1); }
        #text-input { background: none; border: none; color: white; flex: 1; padding: 12px 0; outline: none; }
        
        .icon-btn { background: none; border: none; cursor: pointer; color: rgba(255,255,255,0.5); display: flex; align-items: center; transition: 0.3s; }
        .send-btn { color: var(--neon); }

        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
        .burn { animation: burnOut 1.5s forwards; }
        @keyframes burnOut { to { opacity: 0; filter: blur(20px); transform: scale(1.1); } }
    </style>
</head>
<body>

<canvas id="canvas"></canvas>

<div class="app-container">
    <div class="chat-card">
        <div class="header">
            <h1>LEOCHAT</h1>
            <div id="my-id-display" title="Clique para copiar">GERANDO PROTOCOLO...</div>
            <div style="display:flex; gap:10px; margin-top:15px; padding:0 20px;">
                <input type="text" id="peer-id-input" style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:12px; color:white; padding:10px; flex:1; outline:none;" placeholder="ID do Amigo">
                <button class="icon-btn send-btn" id="connect-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg></button>
            </div>
        </div>

        <div class="chat-body" id="chat-body"></div>

        <div id="reply-bar">
            <span id="reply-text"></span>
            <span onclick="cancelReply()" style="cursor:pointer">‚úï</span>
        </div>

        <div class="footer">
            <div class="input-wrapper">
                <button class="icon-btn" id="file-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg></button>
                <input type="text" id="text-input" placeholder="Mensagem...">
                <input type="file" id="hidden-file" style="display:none">
                <button class="icon-btn send-btn" id="send-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button>
            </div>
        </div>
    </div>
</div>

<div id="ctx-menu" class="context-menu">
    <div class="reactions">
        <span class="reaction-btn">‚ù§Ô∏è</span><span class="reaction-btn">üòÇ</span><span class="reaction-btn">üòÆ</span><span class="reaction-btn">üî•</span><span class="reaction-btn">üëç</span>
    </div>
    <div class="menu-opt" id="opt-reply">RESPONDER</div>
</div>

<script>
    const peer = new Peer();
    let conn, activeReply = null, pressTimer;
    const masterKey = "LEOCHAT_ENIGMA_2026";

    // --- L√≥gica de Peer ---
    peer.on('open', id => {
        const el = document.getElementById('my-id-display');
        el.innerText = "ID: " + id;
        el.onclick = () => {
            navigator.clipboard.writeText(id);
            el.innerText = "COPIADO!";
            setTimeout(() => el.innerText = "ID: " + id, 2000);
        };
    });

    peer.on('connection', c => { conn = c; setup(); });
    document.getElementById('connect-btn').onclick = () => { conn = peer.connect(document.getElementById('peer-id-input').value); setup(); };

    function setup() {
        conn.on('open', () => {
            conn.on('data', data => {
                const obj = JSON.parse(CryptoJS.AES.decrypt(data, masterKey).toString(CryptoJS.enc.Utf8));
                addMsg(obj.val, 'received', obj.reply, obj.reaction);
            });
        });
    }

    // --- Chat Funcionalidades ---
    function addMsg(text, type, replyTo = null, reaction = null) {
        const div = document.createElement('div');
        div.className = `msg ${type}`;
        
        if(replyTo) {
            const r = document.createElement('div');
            r.className = 'reply-preview';
            r.innerText = replyTo;
            div.appendChild(r);
        }

        const t = document.createElement('span');
        t.innerText = text;
        div.appendChild(t);

        if(reaction) {
            const re = document.createElement('div');
            re.style = "position:absolute; bottom:-10px; right:10px; font-size:0.8rem";
            re.innerText = reaction;
            div.appendChild(re);
        }

        // Eventos de clique e segurar
        div.onmousedown = (e) => startPress(e, text, div);
        div.ontouchstart = (e) => startPress(e, text, div);
        div.onmouseup = clearPress;
        div.ontouchend = clearPress;

        document.getElementById('chat-body').appendChild(div);
        document.getElementById('chat-body').scrollTop = document.getElementById('chat-body').scrollHeight;
        
        setTimeout(() => { div.classList.add('burn'); setTimeout(() => div.remove(), 1500); }, 30000);
    }

    function startPress(e, text, el) {
        let isLong = false;
        pressTimer = setTimeout(() => {
            isLong = true;
            showMenu(e, text, true); // Responder
        }, 600);
        
        el.onclick = () => {
            if(!isLong) showMenu(e, text, false); // Reagir
        }
    }

    function clearPress() { clearTimeout(pressTimer); }

    function showMenu(e, text, long) {
        const menu = document.getElementById('ctx-menu');
        menu.style.display = 'block';
        menu.style.left = `50%`;
        menu.style.top = `50%`;
        menu.style.transform = `translate(-50%, -50%)`;
        
        document.getElementById('opt-reply').onclick = () => {
            activeReply = text;
            document.getElementById('reply-bar').style.display = 'flex';
            document.getElementById('reply-text').innerText = "Respondendo: " + text;
            menu.style.display = 'none';
        };

        Array.from(document.getElementsByClassName('reaction-btn')).forEach(btn => {
            btn.onclick = () => {
                // Aqui voc√™ enviaria a rea√ß√£o via peer (simplificado)
                menu.style.display = 'none';
            }
        });
    }

    function cancelReply() { activeReply = null; document.getElementById('reply-bar').style.display = 'none'; }

    document.getElementById('send-btn').onclick = () => {
        const input = document.getElementById('text-input');
        if(!input.value || !conn) return;
        const data = JSON.stringify({type: 'text', val: input.value, reply: activeReply});
        conn.send(CryptoJS.AES.encrypt(data, masterKey).toString());
        addMsg(input.value, 'sent', activeReply);
        input.value = ""; cancelReply();
    };

    // --- Matrix Background ---
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    const drops = Array(Math.floor(canvas.width/20)).fill(1);
    function draw() {
        ctx.fillStyle = "rgba(3, 3, 8, 0.1)"; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#00f3ff"; ctx.font = "15px monospace";
        drops.forEach((y, i) => {
            ctx.fillText("01"[Math.floor(Math.random()*2)], i*20, y*20);
            if(y*20 > canvas.height && Math.random() > 0.975) drops[i] = 0;
            drops[i]++;
        });
    }
    setInterval(draw, 50);
    window.onclick = (e) => { if(!e.target.closest('.msg')) document.getElementById('ctx-menu').style.display = 'none'; }
</script>

</body>
</html>
